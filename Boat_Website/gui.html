<!DOCTYPE html>
<html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, minimal-ui">

  <!-- Downloaded from: https://github.com/RobotWebTools/roslibjs/blob/develop/build/roslib.js -->
  <script type="text/javascript" src="src/roslib.js"></script>

  <!-- Downloaded from: https://github.com/xeolabs/xeogl/archive/master.zip -->
  <script src="src/xeogl-master/build/xeogl.js"></script>
  <script src="src/xeogl-master/examples/js/geometry/vectorTextGeometry.js"></script>
  <script src="src/xeogl-master/examples/js/models/STLModel.js"></script>
  <script src="src/xeogl-master/examples/js/animation/cameraFollowAnimation.js"></script>
  <script src="src/xeogl-master/examples/js/skyboxes/skybox.js"></script>

  <!-- Downloaded from: https://github.com/chartjs/Chart.js/releases/tag/v2.9.3 -->
  <script src="src/Chart.js-2.9.3/dist/Chart.js"></script>
  <!-- Downloaded from: https://hammerjs.github.io/dist/hammer.min.js -->
  <script src="src/hammer.min.js"></script>
  <!-- Downloaded from: https://github.com/chartjs/chartjs-plugin-zoom/tree/v0.7.7 -->
  <script src="src/chartjs-plugin-zoom-0.7.7/dist/chartjs-plugin-zoom.js"></script>

  <script src="src/divTabs.js"></script>

  <!-- Downloaded from: https://api.mapbox.com/mapbox-gl-js/v1.8.1/mapbox-gl.js -->
  <script src='https://api.mapbox.com/mapbox-gl-js/v1.8.1/mapbox-gl.js'></script>
  <!-- Downloaded from: https://api.mapbox.com/mapbox-gl-js/v1.8.1/mapbox-gl.css -->
  <link href='https://api.mapbox.com/mapbox-gl-js/v1.8.1/mapbox-gl.css' rel='stylesheet' />

  <!-- Creating Global Variables -->
  <script type="text/javascript">
    var scene;
    var skybox;
    var BoatModel;
    var camera;
    var followAnimation;

    const zeroAxisButton = 8; // The start button on the Logitech Gamepad F310
    const leftJoystickVert = 1; // The index of the left joystick's vertical axis
    const rightJoystickVert = 4; // The index of the left joystick's vertical axis
    var axisOffset = [0, 0, 0, 0, 0, 0];
    var gpPollInt = 100;
    var gpidx;
    var controlPolling;
    var axisZeroed = false;

    var orientation_deg = [0, 0, 0]
    var IMU_Cnt = 0;
    var IMU_Accel_Cnt = 0;
    var IMU_AngVel_Cnt = 0;
    var IMU_MagVec_Cnt = 0;

    var map;
    var marker;
    var GPS_latitude = 0;
    var GPS_longitude = 0;
    var GPS_altitude = 0;
    var GPS_fix = 0;
    var GPS_fixquality = 0;

    var MAX_PLOT_IDX = 100;
    var PLOT_UPDATE_FREQUENCY = 10; // Hz

    var bat_6s;
    var bat_4s;
    var bat_3sa;
    var bat_3sb;

    var ros;
    var ard_LeftPWM_listener;
    var ard_RightPWM_listener;
    var BatteryListener;
    var IMU_AbsOrientationListener;
    var IMU_LinearAccelerationListener;
    var IMU_AngularVelocityListener;
    var IMU_MagnetometerListener;
    var GPS_Coordinates;
    var ControlMode;

    var IMU_OrientationLastUpdateTime = 0;
    var IMU_LinearAccelerationLastUpdateTime = 0;
    var IMU_AngularVelocityLastUpdateTime = 0;
    var IMU_MagnetometerLastUpdateTime = 0;

    var timeFormatter = new Intl.DateTimeFormat('en-us', {
      hour: 'numeric',
      minute: 'numeric',
      second: 'numeric',
      fractionalSecondDigits: 3,
      hour12: true,
      timeZone: 'UTC'
    });

    function updateControlMode() {
      var Bool_msg = new ROSLIB.Message({
        data: !document.getElementById('controlCheck').checked
      });
      ControlMode.publish(Bool_msg);
    }
  </script>

  <script src="src/ros_setup.js"></script>


  <!-- Styles -->
  <style>
    #canvas-holder {
      background-color: #FFFFFF;
      position: relative;
      top: 8px;
      left: 8px;
      right: 8px;
      bottom: 8px;
    }

    * {
      box-sizing: border-box;
    }

    #map {
      height: 30vw;
    }

    body {
      font-family: Arial, Helvetica, sans-serif;
    }

    /* Style the header */
    .header {
      background-color: #f1f1f1;
      padding: 5vw;
      text-align: center;
      font-size: 35px;
    }

    .columnHeader {
      background-color: #f1f1f1;
      padding: 3px;
      text-align: center;
      font-size: 20px;
      color: black;
    }

    /* Container for flexboxes */
    .row {
      display: -webkit-flex;
      display: flex;
      color: black;
    }

    /* Create three equal columns that sits next to each other */
    .column {
      -webkit-flex: 1;
      -ms-flex: 1;
      flex: 1;
      padding: 1vw;
      color: black;

      /* Should be removed. Only for demonstration */
    }

    /* Style the footer */
    .footer {
      background-color: #f1f1f1;
      padding: 10px;
      text-align: center;
    }

    /* Responsive layout - makes the three columns stack on top of each other instead of next to each other */
    @media (max-width: 600px) {
      .row {
        -webkit-flex-direction: column;
        flex-direction: column;
      }
    }



    /* Style the tab */
    .tab {
      overflow: hidden;
      border: 1px solid #ccc;
      background-color: #f1f1f1;
    }

    /* Style the buttons that are used to open the tab content */
    .tab button {
      /*
      background-color: inherit;
      float: left;
      border: none;
      outline: none;
      cursor: pointer;
      padding: 14px 16px;
      transition: 0.3s;
      */
      font-family: Arial, Helvetica, sans-serif;
      font-size: 15px;
      background-color: inherit;
      cursor: pointer;
      transition: 0s;
      -webkit-flex: 1;
      -ms-flex: 1;
      flex: 1;
      padding: 1vw;
    }

    /* Change background color of buttons on hover */
    .tab button:hover {
      background-color: #ddd;
    }

    /* Create an active/current tablink class */
    .tab button.active {
      background-color: #ccc;
    }

    /* Style the tab content */
    .tabcontent {
      display: none;
      padding: 6px 12px;
      border: 1px solid #ccc;
      border-top: none;
    }

    .onoffswitch {
      position: relative;
      width: 157px;
      -webkit-user-select: none;
      -moz-user-select: none;
      -ms-user-select: none;
    }

    .onoffswitch-checkbox {
      display: none;
    }

    .onoffswitch-label {
      display: block;
      overflow: hidden;
      cursor: pointer;
      border: 2px solid #999999;
      border-radius: 20px;
    }

    .onoffswitch-inner {
      display: block;
      width: 200%;
      margin-left: -100%;
      transition: margin 0.3s ease-in 0s;
    }

    .onoffswitch-inner:before,
    .onoffswitch-inner:after {
      display: block;
      float: left;
      width: 50%;
      height: 33px;
      padding: 0;
      line-height: 33px;
      font-size: 14px;
      color: white;
      font-family: Trebuchet, Arial, sans-serif;
      font-weight: bold;
      box-sizing: border-box;
    }

    .onoffswitch-inner:before {
      content: "MANUAL";
      padding-left: 10px;
      background-color: #FFFF00;
      color: #000000;
    }

    .onoffswitch-inner:after {
      content: "AUTONOMOUS";
      padding-right: 10px;
      background-color: #00DDFF;
      color: #000000;
      text-align: right;
    }

    .onoffswitch-switch {
      display: block;
      width: 23px;
      margin: 5px;
      background: #FFFFFF;
      position: absolute;
      top: 0;
      bottom: 0;
      right: 120px;
      border: 2px solid #999999;
      border-radius: 20px;
      transition: all 0.3s ease-in 0s;
    }

    .onoffswitch-checkbox:checked+.onoffswitch-label .onoffswitch-inner {
      margin-left: 0;
    }

    .onoffswitch-checkbox:checked+.onoffswitch-label .onoffswitch-switch {
      right: 0px;
    }

    table {
      border-collapse: collapse;
      width: 100%;
    }

    th,
    td {
      padding: 15px;
      text-align: center;
      border-bottom: 1px solid #ddd;
    }

    th.thin {
      padding: 5px;
    }

    td.thin {
      padding: 5px;
    }

    th.right {
      text-align: right;
    }

    td.right {
      text-align: right;
    }

    th.left {
      text-align: left;
    }

    td.left {
      text-align: left;
    }
.button {
  background-color: #4CAF50; /* Green */
  border: none;
  color: white;
  padding: 8px 32px;
  text-align: center;
  text-decoration: none;
  display: inline-block;
  font-size: 16px;
  margin: 4px 2px;
  transition-duration: 0.4s;
  cursor: pointer;
}

.button1 {
  background-color: white;
  color: black;
  border: 2px solid #4CAF50;
}

.button1:hover {
  background-color: #4CAF50;
  color: white;
}

    /* We're working with the body tag, and so with the WHOLE page */
    head {
      background-color: black;
      /* The page background will be black */
      color: white;
      /* The page text will be white */
    }

    /* We're working with the body tag, and so with the WHOLE page */
    body {
      background-color: black;
      /* The page background will be black */
      color: white;
      /* The page text will be white */
    }
  </style>


</head>

<body>
  <h1>Temple University RoboBoat - Control Interface</h1>
  <div class="row">
    <div class="column" style="background-color:#aaa;">
      <div class="columnHeader">
        ROS Status
      </div>

      <br>
      <table>
        <tr>
          <th class="left">Rosbridge Connection Status</th>
          <td><span id="rosConnStatus"></span></td>
        </tr>
        <tr>
          <th class="left">Control Mode</th>
          <td>
            <div class="onoffswitch">
              <input type="checkbox" name="onoffswitch" class="onoffswitch-checkbox" id="controlCheck" onclick="ControlMode.publish(new ROSLIB.Message({data: document.getElementById('controlCheck').checked}));" checked>
              <label class="onoffswitch-label" for="controlCheck">
                <span class="onoffswitch-inner"></span>
                <span class="onoffswitch-switch"></span>
              </label>
            </div>
          </td>
        </tr>
      </table>
    </div>
    <div class="column" height="115px" style="background-color:#bbb; min-width: 0; min-height: 0;">
      <div class="columnHeader">Controller Input<span id="gamepad_connection"></span></div>
      <canvas id="Chart_Controller" height="110vw"></canvas>
      <table>
        <tr>
          <th class="thin">Left Joystick Reading</th>
          <th class="thin">Right Joystick Reading</th>
        </tr>
        <tr>
          <td class="thin"><span id="lJoystickVal"></span></td>
          <td class="thin"><span id="rJoystickVal"></span></td>
        </tr>
      </table>
    </div>
    <div class="column" height="115px" style="background-color:#ccc; min-width: 0; min-height: 0;">
      <div class="columnHeader">Battery Charge</div>
      <canvas id="Chart_Battery"></canvas>
    </div>
  </div>
  <div class="row">
    <div class="column" style="background-color:#eee; -webkit-flex: 3; min-width: 0; min-height: 0">
      <div class="columnHeader">ZED Camera Stream</div>
      <br>
      <div id="ZED_Raw">
        <img style="max-width: 100%; height: auto; margin: auto;" src="http://10.19.122.102:8080/stream?topic=/zed/zed_node/stereo_raw/image_raw_color">
      </div>
    </div>
  </div>
  <div class="row">
    <div class="column" style="background-color:#aaa; min-width: 0; min-height: 0;">
      <div class="columnHeader">LIDAR Info</div>
      <br>
      <table>
        <tr>
          <th class="left">Last Measured Time</th>
          <td class="right"><span id="LIDAR_last_measured_Time"></span></td>
        </tr>
        <tr>
          <th class="left">Minimum Displayed Range</th>
          <td class="right"><span id="LIDAR_range_min"></span> [m]</td>
        </tr>
        <tr>
          <th class="left">Maximum Displayed Range</th>
          <td class="right"><span id="LIDAR_range_max"></span> [m]</td>
        </tr>
        <tr>
          <th class="left">Time Between Point Measurements</th>
          <td class="right"><span id="LIDAR_time_increment"></span> [ms]</td>
        </tr>
        <tr>
          <th class="left">Time Between Complete Scans</th>
          <td class="right"><span id="LIDAR_scan_time"></span> [ms]</td>
        </tr>
      </table>
      <table>
        <tr>
          <td class="thin"><button class="button button1" onclick="Chart_LIDAR.resetZoom();">Reset Pan/Zoom</button></td>
        </tr>
      </table>

    </div>
    <div class="column" style="background-color:#bbb; -webkit-flex: 3; min-width: 0; min-height: 0;">
      <div class="columnHeader">LIDAR Data</div>
      <canvas id="Chart_LIDAR" height="90vw"></canvas>
    </div>
  </div>
  <div class="row">
    <div class="column" style="background-color:#eee;">
      <div class="columnHeader">IMU Data</div>
    </div>
  </div>
  <div class="row">
    <div class="column" width="25vw" style="background-color:#aaa; align-items: center; justify-content: center;">
      <canvas id="myCanvas" style="position:relative;top: 0px; left: 0px;  width: 25vw; height: 30vw;"></canvas>
    </div>
    <div class="column" style="background-color:#bbb; -webkit-flex: 3; min-width: 0; min-height: 0">
      <!-- Tab links -->
      <div class="tab">
        <button class="tablinks" onclick="openCity(event, 'Tab_IMU_OrientationDeg')" id="Tab_Default_IMU">Orientation</button>
        <button class="tablinks" onclick="openCity(event, 'Tab_IMU_Accel')">Linear Acceleration</button>
        <button class="tablinks" onclick="openCity(event, 'Tab_IMU_AngVel')">Angular Velocity</button>
        <button class="tablinks" onclick="openCity(event, 'Tab_IMU_Magnetometer')">Vector Magnetometer</button>

      </div>
      <!-- Tab content -->
      <div id="Tab_IMU_OrientationDeg" class="tabcontent">
        <canvas id="Chart_OrientationDeg" height="115vw"></canvas>
      </div>

      <div id="Tab_IMU_Accel" class="tabcontent">
        <canvas id="Chart_Acceleration" height="115vw"></canvas>
      </div>

      <div id="Tab_IMU_AngVel" class="tabcontent">
        <canvas id="Chart_AngVel" height="115vw"></canvas>
      </div>

      <div id="Tab_IMU_Magnetometer" class="tabcontent">
        <canvas id="Chart_Magnetometer" height="115vw"></canvas>
      </div>

    </div>
  </div>
  <div class="row">
    <div class="column" style="background-color:#eee;">
      <div class="columnHeader">GPS Data</div>
    </div>
  </div>
  <div class="row">
    <div class="column" style="background-color:#aaa; align-items: center; justify-content: center;">
      <div class="columnHeader">
        GPS Topic Data
      </div>
      <br>
      <br>
      <br>
      <table>
        <tr>
          <th class="left">GPS Fix</th>
          <td class="right"><span id="GPS_fix"></span></td>
        </tr>
        <tr>
          <th class="left">Fix Quality</th>
          <td class="right"><span id="GPS_fixquality"></span></td>
        </tr>
        <tr>
          <th class="left">Latitude</th>
          <td class="right"><span id="GPS_latitude"></span> [deg]</td>
        </tr>
        <tr>
          <th class="left">Longitude</th>
          <td class="right"><span id="GPS_longitude"></span> [deg]</td>
        </tr>
        <tr>
          <th class="left">Altitude</th>
          <td class="right"><span id="GPS_altitude"></span> [cm]</td>
        </tr>
      </table>
    </div>
    <div class="column" style="background-color:#bbb; -webkit-flex: 2">
      <div class="columnHeader">
        Map
      </div>
      <div id="map"></div>
    </div>
  </div>
</body>

<script src="src/OrientationAnimation.js"></script>
<script src="src/chart_create.js"></script>
<script src="src/chart_update.js"></script>
<script src="src/mapbox_setup.js"></script>
<script src="src/ros_handlers.js"></script>
<script src="src/gamepad_control.js"></script>


<style>

</style>

</html>
